name: Cppcheck Static Analysis

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  cppcheck:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      
      - name: Install Cppcheck
        run: sudo apt-get install -y cppcheck

      - name: Run Cppcheck
        run: |
          cppcheck --enable=all \
                   --inline-suppr \
                   --force \
                   --error-exitcode=1 \
                   --suppress=missingIncludeSystem \
                   --suppress=unusedFunction \
                   --suppress=cstyleCast \
                   --suppress=missingInclude \
                   src/ESP32/src/ \
                   src/ESP32/lib/ \
                   -I src/ESP32/include/ \
                   -I src/ESP32/src/ \
                   $(find src/ESP32/lib -type d -printf "-I %p ")
